<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Governance Evaluation Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="page">
  <header class="top-bar">
    <div class="logo-pill">AI</div>
    <div class="top-text">
      <div class="top-title">Governance Ideation</div>
      <div class="top-subtitle">Lightweight MVP for early-stage startups</div>
    </div>
  </header>

  <main class="card">
    <div class="results-header">
      <h1>Governance Evaluation</h1>
      <p class="intro">Here's the detailed assessment of your AI system idea based on governance best practices.</p>
    </div>

    {% if error %}
      <div class="result error">{{ error }}</div>
      <div class="actions" style="margin-top: 24px;">
        <a href="/" class="btn-secondary">← Back to Wizard</a>
      </div>
    {% endif %}

    {% if result %}
      {% if scores and scores.overall_score is defined %}
      <div class="score-card">
        <div class="score-main">
          <div class="score-number {% if scores.overall_score >= 70 %}score-green{% elif scores.overall_score >= 40 %}score-yellow{% else %}score-red{% endif %}">
            {{ scores.overall_score }}
          </div>
          <div class="score-label">Governance Readiness Score</div>
        </div>
        <div class="score-details">
          {% if scores.external_impact is defined %}
          <div class="score-item">
            <div class="score-item-label">External Impact</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.external_impact == 'Low' %}bar-green{% elif scores.external_impact == 'Medium' %}bar-yellow{% else %}bar-red{% endif %}" 
                   style="width: {% if scores.external_impact == 'Low' %}30{% elif scores.external_impact == 'Medium' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.external_impact == 'Low' %}badge-green{% elif scores.external_impact == 'Medium' %}badge-yellow{% else %}badge-red{% endif %}">
              {{ scores.external_impact }}
            </span>
          </div>
          {% endif %}
          {% if scores.internal_failure is defined %}
          <div class="score-item">
            <div class="score-item-label">Internal Failure Risk</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.internal_failure == 'Low' %}bar-green{% elif scores.internal_failure == 'Medium' %}bar-yellow{% else %}bar-red{% endif %}"
                   style="width: {% if scores.internal_failure == 'Low' %}30{% elif scores.internal_failure == 'Medium' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.internal_failure == 'Low' %}badge-green{% elif scores.internal_failure == 'Medium' %}badge-yellow{% else %}badge-red{% endif %}">
              {{ scores.internal_failure }}
            </span>
          </div>
          {% endif %}
          {% if scores.regulatory_sensitivity is defined %}
          <div class="score-item">
            <div class="score-item-label">Regulatory Sensitivity</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.regulatory_sensitivity == 'Low' %}bar-green{% elif scores.regulatory_sensitivity == 'Medium' %}bar-yellow{% else %}bar-red{% endif %}"
                   style="width: {% if scores.regulatory_sensitivity == 'Low' %}30{% elif scores.regulatory_sensitivity == 'Medium' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.regulatory_sensitivity == 'Low' %}badge-green{% elif scores.regulatory_sensitivity == 'Medium' %}badge-yellow{% else %}badge-red{% endif %}">
              {{ scores.regulatory_sensitivity }}
            </span>
          </div>
          {% endif %}
        </div>
      </div>
      
      <div class="score-ranges">
        <h3>Understanding Your Score</h3>
        <div class="range-item range-green">
          <span class="range-label">70-100</span>
          <span class="range-title">High Readiness</span>
          <p>Strong governance foundations. Low external harm risk, manageable internal failure risk, and clear regulatory pathway. Proceed with standard development practices and periodic governance check-ins.</p>
        </div>
        <div class="range-item range-yellow">
          <span class="range-label">40-69</span>
          <span class="range-title">Moderate Readiness</span>
          <p>Shows promise but has governance gaps that need attention. Address the conditions listed, strengthen weak areas, and consider additional safeguards. Proceed with caution and enhanced oversight.</p>
        </div>
        <div class="range-item range-red">
          <span class="range-label">0-39</span>
          <span class="range-title">Low Readiness</span>
          <p>Significant governance concerns exist. High risk of external harm, regulatory complications, or fundamental gaps in data/legal foundations. Substantial remediation required before proceeding.</p>
        </div>
      </div>
      {% endif %}

      {% if vendors and vendors|length > 0 %}
      <div class="vendors-section">
        <h2>Third-Party Vendor Risk Profiles</h2>
        <p class="vendors-intro">The following vendors were detected in your submission. Review their data provenance and risk profiles below.</p>
        
        {% for vendor in vendors %}
        <div class="vendor-card">
          <div class="vendor-header">
            <h3><span class="vendor-logo">{{ vendor.logo }}</span> {{ vendor.name }}</h3>
            <span class="transparency-badge transparency-{{ vendor.transparency.level|lower|replace('-', '')|replace(' ', '') }}">
              {{ vendor.transparency.level }} Transparency
            </span>
          </div>
          
          <div class="vendor-section">
            <h4>Training Data Profile</h4>
            <div class="vendor-grid">
              <div class="vendor-item">
                <span class="vendor-label">Sources</span>
                <span class="vendor-value">{{ vendor.trainingData.sources }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Knowledge Cutoff</span>
                <span class="vendor-value">{{ vendor.trainingData.cutoffDate }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Geographic Coverage</span>
                <span class="vendor-value">{{ vendor.trainingData.geographicCoverage }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Known Datasets</span>
                <span class="vendor-value">{{ vendor.trainingData.knownDatasets }}</span>
              </div>
            </div>
          </div>
          
          <div class="vendor-section">
            <h4>Known Biases & Limitations</h4>
            <ul class="vendor-list">
              {% for bias in vendor.knownBiases %}
              <li>{{ bias }}</li>
              {% endfor %}
            </ul>
          </div>
          
          <div class="vendor-section">
            <h4>Risk Flags</h4>
            <div class="risk-flags">
              {% for risk in vendor.risks %}
              <div class="risk-flag risk-{{ risk.severity }}">
                <span class="risk-severity">{{ risk.severity|upper }}</span>
                <span class="risk-text">{{ risk.text }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
          
          <div class="vendor-section">
            <h4>Compliance Notes</h4>
            <div class="vendor-grid">
              <div class="vendor-item">
                <span class="vendor-label">GDPR</span>
                <span class="vendor-value">{{ vendor.compliance.gdpr }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">EU AI Act</span>
                <span class="vendor-value">{{ vendor.compliance.euAiAct }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Licensing</span>
                <span class="vendor-value">{{ vendor.compliance.licensing }}</span>
              </div>
            </div>
          </div>
          
          <div class="vendor-section">
            <h4>Due Diligence Questions</h4>
            <ol class="vendor-questions">
              {% for question in vendor.dueDiligenceQuestions %}
              <li>{{ question }}</li>
              {% endfor %}
            </ol>
          </div>
          
          <div class="vendor-note">
            <strong>Last Updated:</strong> {{ vendor.lastUpdated }} | 
            <a href="{{ vendor.documentationUrl }}" target="_blank" rel="noopener noreferrer">View Documentation</a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <div class="result-content">{{ result }}</div>
      
      <div class="results-actions">
        <button onclick="startNewEvaluation()" class="btn-secondary">← Start New Evaluation</button>
        <button onclick="window.print()" class="btn-primary">Print / Save PDF</button>
      </div>
    {% endif %}
  </main>
</div>

<script>
function startNewEvaluation() {
  // Clear all form data from sessionStorage
  Object.keys(sessionStorage).forEach(key => {
    if (key.startsWith('gov_')) {
      sessionStorage.removeItem(key);
    }
  });
  // Redirect to the form
  window.location.href = '/';
}
</script>
</body>
</html>
