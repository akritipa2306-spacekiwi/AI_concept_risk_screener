<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Governance Evaluation Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<style>
  .score-card {
    background: white;
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15);
    margin-bottom: 28px;
    text-align: center;
  }
  .score-dashboard {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 32px;
  }
  .score-number-large {
    font-size: 96px;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 8px;
  }
  .score-number-large.score-green { color: #10b981; }
  .score-number-large.score-yellow { color: #f59e0b; }
  .score-number-large.score-red { color: #ef4444; }
  .score-subtitle {
    font-size: 14px;
    font-weight: 600;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }
  .score-divider {
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
    margin: 24px 0;
  }
  .score-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    text-align: left;
  }
  .score-item {
    background: #f8fafc;
    border-radius: 12px;
    padding: 16px;
  }
  .score-item-label {
    font-size: 12px;
    font-weight: 600;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }
  .score-bar-container {
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
  }
  .score-bar {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
  }
  .bar-green { background: linear-gradient(90deg, #10b981, #34d399); }
  .bar-yellow { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
  .bar-red { background: linear-gradient(90deg, #ef4444, #f87171); }
  .score-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }
  .badge-green { background: #d1fae5; color: #065f46; }
  .badge-yellow { background: #fef3c7; color: #92400e; }
  .badge-red { background: #fee2e2; color: #991b1b; }
  .badge-excellent { background: #d1fae5; color: #065f46; }
  .badge-moderate { background: #fef3c7; color: #92400e; }
  .badge-weak { background: #fee2e2; color: #991b1b; }
  .badge-strong { background: #d1fae5; color: #065f46; }
</style>
<div class="page">
  <header class="top-bar">
    <div class="logo-pill">AI</div>
    <div class="top-text">
      <div class="top-title">Governance Ideation</div>
      <div class="top-subtitle">Lightweight MVP for early-stage startups</div>
    </div>
  </header>

  <main class="card">
    <div class="results-header">
      <h1>Governance Evaluation</h1>
      <p class="intro">Here's the detailed assessment of your AI system idea based on governance best practices.</p>
    </div>

    {% if error %}
      <div class="result error">{{ error }}</div>
      <div class="actions" style="margin-top: 24px;">
        <a href="/" class="btn-secondary">← Back to Wizard</a>
      </div>
    {% endif %}

    {% if result %}
      {% if scores and scores.overall_score is defined %}
      <div class="score-card">
        <div class="score-dashboard">
          <div class="score-number-large {% if scores.overall_score >= 70 %}score-green{% elif scores.overall_score >= 40 %}score-yellow{% else %}score-red{% endif %}">
            {{ scores.overall_score }}
          </div>
          <div class="score-subtitle">NIST-Weighted Governance Score</div>
        </div>
        <div class="score-divider"></div>
        <div class="score-details">
          {% if scores.external_impact is defined %}
          <div class="score-item">
            <div class="score-item-label">External Impact Risk</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.external_impact == 'Low' %}bar-green{% elif scores.external_impact == 'Medium' %}bar-yellow{% else %}bar-red{% endif %}" 
                   style="width: {% if scores.external_impact == 'Low' %}30{% elif scores.external_impact == 'Medium' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.external_impact == 'Low' %}badge-green{% elif scores.external_impact == 'Medium' %}badge-yellow{% else %}badge-red{% endif %}">
              {{ scores.external_impact }}
            </span>
          </div>
          {% endif %}
          {% if scores.internal_failure is defined %}
          <div class="score-item">
            <div class="score-item-label">Internal Failure Risk</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.internal_failure == 'Low' %}bar-green{% elif scores.internal_failure == 'Medium' %}bar-yellow{% else %}bar-red{% endif %}"
                   style="width: {% if scores.internal_failure == 'Low' %}30{% elif scores.internal_failure == 'Medium' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.internal_failure == 'Low' %}badge-green{% elif scores.internal_failure == 'Medium' %}badge-yellow{% else %}badge-red{% endif %}">
              {{ scores.internal_failure }}
            </span>
          </div>
          {% endif %}
          {% if scores.regulatory_sensitivity is defined %}
          <div class="score-item">
            <div class="score-item-label">Regulatory Sensitivity</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.regulatory_sensitivity == 'Low' %}bar-green{% elif scores.regulatory_sensitivity == 'Medium' %}bar-yellow{% else %}bar-red{% endif %}"
                   style="width: {% if scores.regulatory_sensitivity == 'Low' %}30{% elif scores.regulatory_sensitivity == 'Medium' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.regulatory_sensitivity == 'Low' %}badge-green{% elif scores.regulatory_sensitivity == 'Medium' %}badge-yellow{% else %}badge-red{% endif %}">
              {{ scores.regulatory_sensitivity }}
            </span>
          </div>
          {% endif %}
          {% if scores.data_legal_soundness is defined %}
          <div class="score-item">
            <div class="score-item-label">Data & Legal Soundness</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.data_legal_soundness == 'Excellent' %}bar-green{% elif scores.data_legal_soundness == 'Moderate' %}bar-yellow{% else %}bar-red{% endif %}"
                   style="width: {% if scores.data_legal_soundness == 'Excellent' %}30{% elif scores.data_legal_soundness == 'Moderate' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.data_legal_soundness == 'Excellent' %}badge-excellent{% elif scores.data_legal_soundness == 'Moderate' %}badge-moderate{% else %}badge-weak{% endif %}">
              {{ scores.data_legal_soundness }}
            </span>
          </div>
          {% endif %}
          {% if scores.purpose_clarity is defined %}
          <div class="score-item">
            <div class="score-item-label">Purpose & MVP Clarity</div>
            <div class="score-bar-container">
              <div class="score-bar {% if scores.purpose_clarity == 'Strong' %}bar-green{% elif scores.purpose_clarity == 'Moderate' %}bar-yellow{% else %}bar-red{% endif %}"
                   style="width: {% if scores.purpose_clarity == 'Strong' %}30{% elif scores.purpose_clarity == 'Moderate' %}60{% else %}90{% endif %}%"></div>
            </div>
            <span class="score-badge {% if scores.purpose_clarity == 'Strong' %}badge-strong{% elif scores.purpose_clarity == 'Moderate' %}badge-moderate{% else %}badge-weak{% endif %}">
              {{ scores.purpose_clarity }}
            </span>
          </div>
          {% endif %}
        </div>
      </div>
      
      <div class="score-ranges">
        <h3>Understanding Your Score</h3>
        <div class="range-item range-green">
          <span class="range-label">70-100</span>
          <span class="range-title">High Readiness</span>
          <p>Strong governance foundations. Low external harm risk, manageable internal failure risk, and clear regulatory pathway. Proceed with standard development practices and periodic governance check-ins.</p>
        </div>
        <div class="range-item range-yellow">
          <span class="range-label">40-69</span>
          <span class="range-title">Moderate Readiness</span>
          <p>Shows promise but has governance gaps that need attention. Address the conditions listed, strengthen weak areas, and consider additional safeguards. Proceed with caution and enhanced oversight.</p>
        </div>
        <div class="range-item range-red">
          <span class="range-label">0-39</span>
          <span class="range-title">Low Readiness</span>
          <p>Significant governance concerns exist. High risk of external harm, regulatory complications, or fundamental gaps in data/legal foundations. Substantial remediation required before proceeding.</p>
        </div>
      </div>
      {% endif %}

      {% if vendors and vendors|length > 0 %}
      <div class="vendors-section">
        <h2>Third-Party Vendor Risk Profiles</h2>
        <p class="vendors-intro">The following vendors were detected in your submission. Review their data provenance and risk profiles below.</p>
        
        {% for vendor in vendors %}
        <div class="vendor-card">
          <div class="vendor-header">
            <h3><span class="vendor-logo">{{ vendor.logo }}</span> {{ vendor.name }}</h3>
            <span class="transparency-badge transparency-{{ vendor.transparency.level|lower|replace('-', '')|replace(' ', '') }}">
              {{ vendor.transparency.level }} Transparency
            </span>
          </div>
          
          <div class="vendor-section">
            <h4>Training Data Profile</h4>
            <div class="vendor-grid">
              <div class="vendor-item">
                <span class="vendor-label">Sources</span>
                <span class="vendor-value">{{ vendor.trainingData.sources }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Knowledge Cutoff</span>
                <span class="vendor-value">{{ vendor.trainingData.cutoffDate }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Geographic Coverage</span>
                <span class="vendor-value">{{ vendor.trainingData.geographicCoverage }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Known Datasets</span>
                <span class="vendor-value">{{ vendor.trainingData.knownDatasets }}</span>
              </div>
            </div>
          </div>
          
          <div class="vendor-section">
            <h4>Known Biases & Limitations</h4>
            <ul class="vendor-list">
              {% for bias in vendor.knownBiases %}
              <li>{{ bias }}</li>
              {% endfor %}
            </ul>
          </div>
          
          <div class="vendor-section">
            <h4>Risk Flags</h4>
            <div class="risk-flags">
              {% for risk in vendor.risks %}
              <div class="risk-flag risk-{{ risk.severity }}">
                <span class="risk-severity">{{ risk.severity|upper }}</span>
                <span class="risk-text">{{ risk.text }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
          
          <div class="vendor-section">
            <h4>Compliance Notes</h4>
            <div class="vendor-grid">
              <div class="vendor-item">
                <span class="vendor-label">GDPR</span>
                <span class="vendor-value">{{ vendor.compliance.gdpr }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">EU AI Act</span>
                <span class="vendor-value">{{ vendor.compliance.euAiAct }}</span>
              </div>
              <div class="vendor-item">
                <span class="vendor-label">Licensing</span>
                <span class="vendor-value">{{ vendor.compliance.licensing }}</span>
              </div>
            </div>
          </div>
          
          <div class="vendor-section">
            <h4>Due Diligence Questions</h4>
            <ol class="vendor-questions">
              {% for question in vendor.dueDiligenceQuestions %}
              <li>{{ question }}</li>
              {% endfor %}
            </ol>
          </div>
          
          <div class="vendor-note">
            <strong>Last Updated:</strong> {{ vendor.lastUpdated }} | 
            <a href="{{ vendor.documentationUrl }}" target="_blank" rel="noopener noreferrer">View Documentation</a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <div class="result-content">{{ result }}</div>
      
      <div class="results-actions">
        <button onclick="startNewEvaluation()" class="btn-secondary">← Start New Evaluation</button>
        <button onclick="window.print()" class="btn-primary">Print / Save PDF</button>
      </div>
    {% endif %}
  </main>
</div>

<script>
function startNewEvaluation() {
  // Clear all form data from sessionStorage
  Object.keys(sessionStorage).forEach(key => {
    if (key.startsWith('gov_')) {
      sessionStorage.removeItem(key);
    }
  });
  // Redirect to the form
  window.location.href = '/';
}
</script>
</body>
</html>
