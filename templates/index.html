<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AI Governance Ideation Assistant</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="page">
  <header class="top-bar">
    <div class="logo-pill">AI</div>
    <div class="top-text">
      <div class="top-title">Governance Ideation</div>
      <div class="top-subtitle">Lightweight MVP for early-stage startups</div>
    </div>
  </header>

  <main class="card">
    <h1>Ideation Wizard</h1>
    <p class="intro">
      Step through a few quick questions to see whether your AI idea should be built — 
      using structured governance checks.
    </p>

    <!-- Step indicator dots -->
    <div class="steps-indicator">
      <span class="dot active" data-step="1"></span>
      <span class="dot" data-step="2"></span>
      <span class="dot" data-step="3"></span>
      <span class="dot" data-step="4"></span>
    </div>

    <form method="POST" id="wizardForm">
      <!-- STEP 1: SYSTEM INTAKE -->
      <section class="wizard-step active" data-step="1">
        <h2>Step 1 · System Intake</h2>
        <p class="step-subtitle">Capture the basic shape of your AI system idea.</p>

        <div class="validation-summary" id="validation-summary-1"></div>
        <div class="grid-2">
          <div class="field">
            <label for="system_name">System name</label>
            <input id="system_name" name="system_name" placeholder="e.g., FairScreen Rentals" required />
          </div>
          <div class="field">
            <label for="ai_type">AI type</label>
            <select id="ai_type" name="ai_type" required>
              <option value="">Select AI type</option>
              <option value="Natural Language Processing (NLP)">Natural Language Processing (NLP)</option>
              <option value="Computer Vision (CV)">Computer Vision (CV)</option>
              <option value="Predictive Modeling">Predictive Modeling</option>
              <option value="Generative AI">Generative AI</option>
              <option value="Autonomous Systems / Control">Autonomous Systems / Control</option>
              <option value="Recommender Systems">Recommender Systems</option>
              <option value="Data Clustering & Segmentation">Data Clustering & Segmentation</option>
              <option value="Speech Processing (ASR/TTS)">Speech Processing (ASR/TTS)</option>
            </select>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="short_description">Short description</label>
            <textarea id="short_description" name="short_description"
                      placeholder="One or two sentences describing what this AI will do." required></textarea>
          </div>
          <div class="field">
            <label for="new_or_update">New or update?</label>
            <select id="new_or_update" name="new_or_update" required>
              <option value="">Select one</option>
              <option>New system</option>
              <option>Update to existing system</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="primary_intent">What is the primary intent of this AI system?</label>
          <select id="primary_intent" name="primary_intent" required>
            <option value="">Select primary intent</option>
            <option value="Automate decision-making">Automate decision-making</option>
            <option value="Provide recommendations">Provide recommendations</option>
            <option value="Generate content">Generate content</option>
            <option value="Detect anomalies">Detect anomalies</option>
            <option value="Classify or score">Classify or score</option>
            <option value="Retrieve information">Retrieve information</option>
            <option value="Assist humans in workflows">Assist humans in workflows</option>
          </select>
        </div>

        <div class="field regulatory-section">
          <label class="section-label">Does this use case trigger regulatory exposure?</label>
          <p class="field-hint">Select all that apply:</p>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" name="reg_biometric" value="yes" />
              <span>Uses biometric data</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="reg_minors" value="yes" />
              <span>Involves minors</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="reg_employment" value="yes" />
              <span>Involves employment decisions</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="reg_housing" value="yes" />
              <span>Involves housing decisions</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="reg_credit" value="yes" />
              <span>Involves credit or financial eligibility</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="reg_health" value="yes" />
              <span>Involves health information</span>
            </label>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn-primary" id="next1">Next →</button>
        </div>
      </section>

      <!-- STEP 2: PURPOSE & CONCEPT -->
      <section class="wizard-step" data-step="2">
        <h2>Step 2 · Purpose & Concept</h2>
        <p class="step-subtitle">Clarify the problem, value, and MVP.</p>

        <div class="validation-summary" id="validation-summary-2"></div>
        <div class="grid-2">
          <div class="field">
            <label for="problem">What problem does this solve?</label>
            <textarea id="problem" name="problem"
                      placeholder="Describe the core problem in plain language." required></textarea>
          </div>
          <div class="field">
            <label for="who_problem">Who experiences this problem today?</label>
            <textarea id="who_problem" name="who_problem"
                      placeholder="Teams, roles, or customer segments." required></textarea>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="value_created">What value does AI create?</label>
            <textarea id="value_created" name="value_created"
                      placeholder="Time saved, risk reduced, revenue, etc." required></textarea>
          </div>
          <div class="field">
            <label for="non_ai_alt">Non-AI alternative today</label>
            <textarea id="non_ai_alt" name="non_ai_alt"
                      placeholder="Manual processes, existing tools, etc." required></textarea>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="success_metrics">How will success be measured?</label>
            <textarea id="success_metrics" name="success_metrics"
                      placeholder="e.g., 50% less review time, fewer errors." required></textarea>
          </div>
          <div class="field">
            <label for="mvp_description">MVP – what ships first?</label>
            <textarea id="mvp_description" name="mvp_description"
                      placeholder="Smallest version that still delivers value." required></textarea>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn-secondary" id="back2">← Back</button>
          <button type="button" class="btn-primary" id="next2">Next →</button>
        </div>
      </section>

      <!-- STEP 3: LEGAL & DATA FOUNDATIONS -->
      <section class="wizard-step" data-step="3">
        <h2>Step 3 · Legal & Data Foundations</h2>
        <p class="step-subtitle">Surface data, provenance, and third-party risks early.</p>

        <div class="validation-summary" id="validation-summary-3"></div>
        <div class="field-group">
          <label class="group-label">Region of Use / Jurisdiction</label>
          <p class="field-hint">Select all regions where this AI system will be deployed or where users/data subjects are located.</p>
          <div class="checkbox-grid">
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="United States (General sectoral laws + algorithmic accountability emerging)" />
              <span>United States (General sectoral laws + algorithmic accountability emerging)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="European Union (GDPR + EU AI Act)" />
              <span>European Union (GDPR + EU AI Act)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="United Kingdom (UK GDPR + coming AI regulatory principles)" />
              <span>United Kingdom (UK GDPR + coming AI regulatory principles)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="Canada (PIPEDA + AIDA emerging)" />
              <span>Canada (PIPEDA + AIDA emerging)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="Australia (Privacy Act + AI Safety Guidelines)" />
              <span>Australia (Privacy Act + AI Safety Guidelines)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="India (DPDP Act)" />
              <span>India (DPDP Act)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="Singapore (PDPA + Model AI Governance Framework)" />
              <span>Singapore (PDPA + Model AI Governance Framework)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="jurisdictions" value="Other – specify below" />
              <span>Other – specify below</span>
            </label>
          </div>
          <div class="field">
            <label for="jurisdiction_notes">Additional notes or mixed-jurisdiction scenarios (optional)</label>
            <textarea id="jurisdiction_notes" name="jurisdiction_notes"
                      placeholder="Specify other jurisdictions, cross-border data flows, or complex regulatory scenarios."></textarea>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="data_sources">Data sources</label>
            <textarea id="data_sources" name="data_sources"
                      placeholder="Internal databases, logs, public data, etc." required></textarea>
          </div>
          <div class="field">
            <label for="personal_data">Personal / sensitive data involved?</label>
            <textarea id="personal_data" name="personal_data"
                      placeholder="Health data, financial data, biometrics, etc." required></textarea>
          </div>
        </div>

        <div class="field">
          <label for="third_parties">Third-party models / APIs / vendors</label>
          <textarea id="third_parties" name="third_parties"
                    placeholder="LLM providers, SaaS tools, labeling vendors." required></textarea>
        </div>

        <div class="field-group">
          <label class="group-label">Context of Use</label>
          <div class="grid-2">
            <div class="field">
              <label for="deployment_context">Deployment Context</label>
              <select id="deployment_context" name="deployment_context" required>
                <option value="">Select one</option>
                <option>Internal tool</option>
                <option>Customer-facing app</option>
                <option>Integrated into product</option>
                <option>Background automation</option>
                <option>Mobile app</option>
                <option>Unknown</option>
              </select>
            </div>
            <div class="field">
              <label for="level_of_autonomy">Level of Autonomy</label>
              <select id="level_of_autonomy" name="level_of_autonomy" required>
                <option value="">Select one</option>
                <option>Fully automated</option>
                <option>Human-in-the-loop</option>
                <option>Human-on-the-loop</option>
                <option>Manual trigger / AI assist only</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label for="deployment_notes">Anything specific about deployment? (optional)</label>
            <textarea id="deployment_notes" name="deployment_notes"
                      placeholder="Any additional context about how this will be deployed."></textarea>
          </div>
        </div>

        <div class="field">
          <label for="provenance">Data provenance / licensing</label>
          <textarea id="provenance" name="provenance"
                    placeholder="Where data comes from, any licensing or ToS dependencies." required></textarea>
        </div>

        <div class="field conditional-section">
          <label class="checkbox-item standalone-checkbox">
            <input type="checkbox" id="uses_annotators" name="uses_annotators" value="yes" />
            <span>Does any part of this system rely on human annotators, reviewers, or moderators?</span>
          </label>
          
          <div class="conditional-fields" id="annotator-fields">
            <div class="grid-2">
              <div class="field">
                <label for="annotation_source">Annotation source</label>
                <textarea id="annotation_source" name="annotation_source"
                          placeholder="In-house team, crowdsourcing platform, vendor, etc."></textarea>
              </div>
              <div class="field">
                <label for="labour_safeguards">Labour safeguards</label>
                <textarea id="labour_safeguards" name="labour_safeguards"
                          placeholder="Contracts, working conditions, dispute resolution, etc."></textarea>
              </div>
            </div>
            <div class="grid-2">
              <div class="field">
                <label for="pay_verified">Pay is fair & verified</label>
                <textarea id="pay_verified" name="pay_verified"
                          placeholder="How is fair pay ensured and verified?"></textarea>
              </div>
              <div class="field">
                <label for="vulnerable_annotators">Vulnerable annotator groups</label>
                <textarea id="vulnerable_annotators" name="vulnerable_annotators"
                          placeholder="Any concerns about annotator wellbeing or exploitation?"></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="field-group">
          <label class="group-label">Planned Safeguards / Mitigations</label>
          <div class="checkbox-grid">
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Human-in-the-loop review" />
              <span>Human-in-the-loop review</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Access restrictions / role-based controls" />
              <span>Access restrictions / role-based controls</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Audit logging" />
              <span>Audit logging</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Abuse monitoring" />
              <span>Abuse monitoring</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Explainability provided to user" />
              <span>Explainability provided to user</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Manual override" />
              <span>Manual override</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="Rate limits / safety filters" />
              <span>Rate limits / safety filters</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="safeguards" value="None planned yet" />
              <span>None planned yet</span>
            </label>
          </div>
          <div class="field">
            <label for="custom_safeguards">Describe any custom safeguards (optional)</label>
            <textarea id="custom_safeguards" name="custom_safeguards"
                      placeholder="Any additional safeguards or mitigations you're planning."></textarea>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn-secondary" id="back3">← Back</button>
          <button type="button" class="btn-primary" id="next3">Next →</button>
        </div>
      </section>

      <!-- STEP 4: STAKEHOLDERS & IMPACT -->
      <section class="wizard-step" data-step="4">
        <h2>Step 4 · Stakeholders & Impact</h2>
        <p class="step-subtitle">Map who is affected and how much risk you’re willing to carry.</p>

        <div class="validation-summary" id="validation-summary-4"></div>

        <div class="grid-2">
          <div class="field">
            <label for="primary_users">Primary users</label>
            <textarea id="primary_users" name="primary_users"
                      placeholder="Teams or customer segments who will directly use this AI." required></textarea>
          </div>
          <div class="field">
            <label for="affected_groups">Affected groups (including vulnerable)</label>
            <textarea id="affected_groups" name="affected_groups"
                      placeholder="Non-users, downstream groups, or vulnerable populations." required></textarea>
          </div>
        </div>

        <div class="field">
          <label>Which harm pathways may apply?</label>
          <div class="checkbox-grid">
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Bias or unfair outcomes" />
              <span>Bias or unfair outcomes</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Incorrect or unsafe decisions" />
              <span>Incorrect or unsafe decisions</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Exclusion or denial of service" />
              <span>Exclusion or denial of service</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Privacy intrusion" />
              <span>Privacy intrusion</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="IP / rights / licensing issues" />
              <span>IP / rights / licensing issues</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Labour exploitation (annotation, moderation)" />
              <span>Labour exploitation (annotation, moderation)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Security vulnerabilities" />
              <span>Security vulnerabilities</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="harm_pathways" value="Misuse or dual-use risk" />
              <span>Misuse or dual-use risk</span>
            </label>
          </div>
        </div>

        <div class="field">
          <label for="risk_tolerance">Risk tolerance</label>
          <select id="risk_tolerance" name="risk_tolerance" required>
            <option value="">Select one</option>
            <option>Low – very cautious</option>
            <option>Medium – some risk acceptable</option>
            <option>High – aggressive experimentation</option>
          </select>
        </div>

        <div class="actions">
          <button type="button" class="btn-secondary" id="back4">← Back</button>
          <button type="submit" class="btn-primary">Evaluate →</button>
        </div>
      </section>
    </form>

  </main>
</div>

<script>
// Simple multi-step wizard with basic persistence (fields retain values when moving back/next)
let currentStep = 1;
const totalSteps = 4;

function showStep(step) {
  currentStep = step;
  document.querySelectorAll(".wizard-step").forEach(sec => {
    sec.classList.toggle("active", Number(sec.dataset.step) === step);
  });
  document.querySelectorAll(".dot").forEach(dot => {
    dot.classList.toggle("active", Number(dot.dataset.step) === step);
  });
}

// Validation function for a step
function validateStep(stepNum) {
  const stepSection = document.querySelector(`.wizard-step[data-step="${stepNum}"]`);
  const requiredFields = stepSection.querySelectorAll('[required]');
  const summaryDiv = document.getElementById(`validation-summary-${stepNum}`);
  let isValid = true;
  let emptyCount = 0;
  
  // Clear previous validation states
  requiredFields.forEach(field => {
    field.classList.remove('invalid');
  });
  
  // Check each required field
  requiredFields.forEach(field => {
    const value = field.value.trim();
    if (!value) {
      field.classList.add('invalid');
      isValid = false;
      emptyCount++;
      
      // Remove invalid class when user starts typing
      field.addEventListener('input', function handler() {
        if (this.value.trim()) {
          this.classList.remove('invalid');
        }
        this.removeEventListener('input', handler);
      });
    }
  });
  
  // Show or hide validation summary
  if (summaryDiv) {
    if (!isValid) {
      summaryDiv.textContent = `Please fill in ${emptyCount} required field${emptyCount > 1 ? 's' : ''} highlighted below.`;
      summaryDiv.classList.add('visible');
      // Scroll to first invalid field
      const firstInvalid = stepSection.querySelector('.invalid');
      if (firstInvalid) {
        firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        firstInvalid.focus();
      }
    } else {
      summaryDiv.classList.remove('visible');
    }
  }
  
  return isValid;
}

// Navigation with validation
function nextStep(fromStep, toStep) {
  if (validateStep(fromStep)) {
    showStep(toStep);
  }
}

// Navigation buttons
document.getElementById("next1").onclick = () => nextStep(1, 2);
document.getElementById("next2").onclick = () => nextStep(2, 3);
document.getElementById("next3").onclick = () => nextStep(3, 4);
document.getElementById("back2").onclick = () => showStep(1);
document.getElementById("back3").onclick = () => showStep(2);
document.getElementById("back4").onclick = () => showStep(3);

// Validate step 4 before form submission
document.getElementById("wizardForm").addEventListener("submit", function(e) {
  if (!validateStep(4)) {
    e.preventDefault();
  }
});

// Optional: sessionStorage to survive refreshes
const fields = document.querySelectorAll("input, textarea, select");
fields.forEach(field => {
  const key = "gov_" + field.id;
  const saved = sessionStorage.getItem(key);
  if (saved !== null) {
    if (field.type === "checkbox") {
      field.checked = saved === "true";
    } else {
      field.value = saved;
    }
  }
  field.addEventListener("input", () => {
    if (field.type === "checkbox") {
      sessionStorage.setItem(key, field.checked);
    } else {
      sessionStorage.setItem(key, field.value);
    }
  });
});

// Conditional fields toggle for annotators section
const annotatorsCheckbox = document.getElementById("uses_annotators");
const annotatorFields = document.getElementById("annotator-fields");

function toggleAnnotatorFields() {
  if (annotatorsCheckbox.checked) {
    annotatorFields.classList.add("visible");
  } else {
    annotatorFields.classList.remove("visible");
  }
}

annotatorsCheckbox.addEventListener("change", toggleAnnotatorFields);
toggleAnnotatorFields();
</script>
</body>
</html>
